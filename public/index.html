<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anonymous Liberty - Digital Rights & Privacy</title>
<meta name="description" content="Defending Digital Rights in the Information Age">
<meta name="robots" content="noindex, nofollow">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: 'Courier New', monospace;
background: #0a0a0a;
color: #00ff41;
line-height: 1.4;
overflow-x: hidden;
}
/* Matrix background animation */
.matrix-bg {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
pointer-events: none;
z-index: -1;
background: radial-gradient(ellipse at center, #001100 0%, #000000 70%);
}
/* Notification system */
.notification-panel {
position: fixed;
top: 20px;
right: 20px;
z-index: 1000;
}
.notification {
background: #1a1a1a;
border: 1px solid #00ff41;
padding: 15px;
margin-bottom: 10px;

border-radius: 5px;
color: #00ff41;
cursor: pointer;
max-width: 300px;
animation: slideIn 0.3s ease;
}
.notification.error {
border-color: #ff4444;
color: #ff4444;
}
.notification.success {
border-color: #44ff44;
color: #44ff44;
}
@keyframes slideIn {
from { transform: translateX(100%); opacity: 0; }
to { transform: translateX(0); opacity: 1; }
}
/* Decoy site styles */
.decoy-header {
background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
padding: 20px;
border-bottom: 2px solid #00ff41;
text-align: center;
}
.decoy-logo {
font-size: 2.5em;
font-weight: bold;
margin-bottom: 10px;
text-shadow: 0 0 10px #00ff41;
}
.decoy-tagline {
color: #888;
font-size: 1.1em;
}
.decoy-nav {
background: #1a1a1a;
padding: 15px;
text-align: center;
border-bottom: 1px solid #333;
}
.nav-links {
display: inline-flex;
gap: 30px;

flex-wrap: wrap;
justify-content: center;
}
.nav-links a {
color: #00ff41;
text-decoration: none;
padding: 8px 15px;
border: 1px solid transparent;
transition: all 0.3s;
cursor: pointer;
}
.nav-links a:hover, .nav-links a.active {
border-color: #00ff41;
box-shadow: 0 0 5px #00ff41;
}
.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}
.decoy-content {
display: grid;
grid-template-columns: 2fr 1fr;
gap: 30px;
margin-top: 30px;
}
.article {
background: #1a1a1a;
padding: 25px;
border-radius: 5px;
border: 1px solid #333;
margin-bottom: 20px;
}
.sidebar {
background: #1a1a1a;
padding: 25px;
border-radius: 5px;
border: 1px solid #333;
height: fit-content;
}
.form-group {
margin-bottom: 15px;
}
.form-group label {

display: block;
margin-bottom: 5px;
color: #00ff41;
}
.form-group input, .form-group select, .form-group textarea {
width: 100%;
padding: 8px;
background: #0a0a0a;
border: 1px solid #333;
color: #00ff41;
border-radius: 3px;
font-family: 'Courier New', monospace;
}
.btn {
background: #003300;
color: #00ff41;
border: 1px solid #00ff41;
padding: 10px 20px;
cursor: pointer;
border-radius: 3px;
transition: all 0.3s;
text-decoration: none;
display: inline-block;
font-family: 'Courier New', monospace;
margin-right: 10px;
}
.btn:hover {
background: #00ff41;
color: #000;
box-shadow: 0 0 10px #00ff41;
}
.btn-danger {
background: #660000;
border-color: #ff0000;
color: #ff0000;
}
.btn-danger:hover {
background: #ff0000;
color: #fff;
}
.btn-secondary {
background: #333;
border-color: #666;
color: #ccc;

}
.btn-secondary:hover {
background: #666;
color: #fff;
}
.btn-small {
padding: 5px 10px;
font-size: 0.8em;
}
/* Tab system for login/register */
.auth-tabs {
display: flex;
margin-bottom: 20px;
border-bottom: 1px solid #333;
}
.auth-tab {
background: none;
border: none;
color: #666;
padding: 10px 20px;
cursor: pointer;
font-family: 'Courier New', monospace;
border-bottom: 2px solid transparent;
transition: all 0.3s;
}
.auth-tab.active {
color: #00ff41;
border-bottom-color: #00ff41;
}
.auth-tab:hover {
color: #00ff41;
}
.auth-form {
display: none;
}
.auth-form.active {
display: block;
}
/* Hunter-Net Forum Styles */
.hunter-app {
display: none;
min-height: 100vh;
background: #0a0a0a;
}

.hunter-header {
background: linear-gradient(135deg, #1a0000, #330000);
border-bottom: 2px solid #ff4444;
padding: 15px 0;
}
.hunter-header-content {
max-width: 1200px;
margin: 0 auto;
padding: 0 20px;
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
}
.hunter-logo {
display: flex;
align-items: center;
gap: 15px;
}
.hunter-glyphs {
font-size: 1.5em;
color: #ff4444;
}
.hunter-title {
color: #ff4444;
font-size: 1.8em;
font-weight: bold;
}
.user-info {
display: flex;
align-items: center;
gap: 15px;
color: #ff4444;
flex-wrap: wrap;
font-size: 0.9em;
}
.user-stats {
background: #330000;
padding: 5px 10px;
border-radius: 3px;
border: 1px solid #ff4444;
}
.admin-badge {
background: #ffaa00;

color: #000;
padding: 3px 8px;
border-radius: 3px;
font-size: 0.8em;
font-weight: bold;
}
/* Hunter-Net Interface Styles */
.hunter-nav {
background: #1a0000;
padding: 15px;
border-bottom: 1px solid #330000;
}
.hunter-nav-links {
max-width: 1200px;
margin: 0 auto;
display: flex;
gap: 30px;
flex-wrap: wrap;
}
.hunter-nav-links a {
color: #ff4444;
text-decoration: none;
padding: 8px 15px;
border: 1px solid transparent;
transition: all 0.3s;
cursor: pointer;
}
.hunter-nav-links a:hover, .hunter-nav-links a.active {
border-color: #ff4444;
box-shadow: 0 0 5px #ff4444;
}
.hunter-content {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}
.board-list {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 20px;
margin: 20px 0;
}
.board-card {
background: #1a0000;

border: 1px solid #330000;
border-radius: 5px;
padding: 20px;
cursor: pointer;
transition: all 0.3s;
}
.board-card:hover {
border-color: #ff4444;
box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
}
.board-title {
color: #ff4444;
font-size: 1.2em;
font-weight: bold;
margin-bottom: 10px;
}
.board-description {
color: #ccc;
font-size: 0.9em;
}
.thread-list {
margin: 20px 0;
}
.thread-item {
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
padding: 15px;
margin-bottom: 10px;
cursor: pointer;
transition: all 0.3s;
}
.thread-item:hover {
border-color: #ff4444;
}
.thread-item.sticky {
border-color: #ffaa00;
background: #2a1a00;
}
.thread-item.locked {
opacity: 0.7;
}
.thread-title {
color: #ff4444;

font-weight: bold;
margin-bottom: 5px;
}
.thread-meta {
color: #888;
font-size: 0.8em;
display: flex;
gap: 15px;
flex-wrap: wrap;
align-items: center;
}
.signal-badge {
background: #330000;
color: #ff4444;
padding: 2px 6px;
border-radius: 3px;
font-size: 0.7em;
border: 1px solid #ff4444;
}
.vote-controls {
display: flex;
align-items: center;
gap: 10px;
margin-top: 10px;
}
.vote-btn {
background: none;
border: 1px solid #666;
color: #666;
padding: 5px 8px;
cursor: pointer;
border-radius: 3px;
font-family: 'Courier New', monospace;
transition: all 0.3s;
}
.vote-btn:hover {
border-color: #ff4444;
color: #ff4444;
}
.vote-btn.active-up {
border-color: #44ff44;
color: #44ff44;
background: #001100;
}

.vote-btn.active-down {
border-color: #ff4444;
color: #ff4444;
background: #110000;
}
.vote-count {
color: #888;
font-size: 0.9em;
}
.chat-interface {
display: grid;
grid-template-columns: 200px 1fr;
gap: 20px;
height: calc(100vh - 200px);
}
.chat-rooms {
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
padding: 15px;
overflow-y: auto;
}
.chat-room {
color: #ff4444;
padding: 8px;
cursor: pointer;
border-radius: 3px;
margin-bottom: 5px;
transition: all 0.3s;
}
.chat-room:hover, .chat-room.active {
background: #330000;
}
.chat-main {
display: flex;
flex-direction: column;
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
}
.chat-messages {
flex: 1;
padding: 15px;
overflow-y: auto;

max-height: calc(100vh - 350px);
}
.chat-message {
margin-bottom: 10px;
padding: 8px;
background: #0a0000;
border-radius: 3px;
position: relative;
}
.chat-author {
color: #ff4444;
font-weight: bold;
margin-right: 10px;
cursor: pointer;
}
.chat-time {
color: #666;
font-size: 0.7em;
margin-left: 10px;
}
.chat-input {
border-top: 1px solid #330000;
padding: 15px;
display: flex;
gap: 10px;
}
.chat-input input {
flex: 1;
background: #0a0000;
border: 1px solid #330000;
color: #ff4444;
padding: 8px;
border-radius: 3px;
font-family: 'Courier New', monospace;
}
.form-container {
max-width: 600px;
margin: 20px auto;
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
padding: 25px;
}
.form-container textarea {
min-height: 100px;
resize: vertical;

}
.thread-content {
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
padding: 20px;
margin-bottom: 20px;
}
.post-item {
background: #0a0000;
border: 1px solid #330000;
border-radius: 5px;
padding: 15px;
margin-bottom: 15px;
position: relative;
}
.post-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 10px;
padding-bottom: 10px;
border-bottom: 1px solid #330000;
}
.post-author {
color: #ff4444;
font-weight: bold;
cursor: pointer;
}
.post-time {
color: #666;
font-size: 0.8em;
}
.post-body {
color: #ccc;
white-space: pre-wrap;
margin-bottom: 10px;
}
.admin-panel {
background: #2a1a00;
border: 2px solid #ffaa00;
border-radius: 5px;
padding: 20px;
margin-bottom: 20px;
}
.admin-panel h3 {

color: #ffaa00;
margin-bottom: 15px;
}
.user-list {
max-height: 400px;
overflow-y: auto;
border: 1px solid #333;
border-radius: 3px;
}
.user-item {
background: #1a0000;
border-bottom: 1px solid #333;
padding: 15px;
display: grid;
grid-template-columns: 1fr auto;
gap: 15px;
align-items: center;
}
.user-info-admin {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 10px;
}
.user-actions {
display: flex;
gap: 10px;
flex-wrap: wrap;
}
.account-section {
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
padding: 25px;
max-width: 600px;
margin: 20px auto;
}
.account-info {
background: #0a0000;
border: 1px solid #333;
border-radius: 3px;
padding: 15px;
margin-bottom: 20px;
}
.account-info h4 {

color: #ff4444;
margin-bottom: 10px;
}
.account-info p {
color: #ccc;
margin-bottom: 5px;
}
.danger-zone {
background: #330000;
border: 1px solid #ff4444;
border-radius: 5px;
padding: 20px;
margin-top: 30px;
}
.danger-zone h3 {
color: #ff4444;
margin-bottom: 15px;
}
.hidden {
display: none !important;
}
.loading {
text-align: center;
padding: 20px;
color: #666;
}
.error {
background: #330000;
color: #ff4444;
border: 1px solid #ff4444;
padding: 15px;
border-radius: 5px;
margin: 10px 0;
}
.breadcrumb {
color: #666;
margin-bottom: 20px;
}
.breadcrumb a {
color: #ff4444;
text-decoration: none;
}
.breadcrumb a:hover {
text-decoration: underline;

}
.image-preview {
max-width: 300px;
max-height: 200px;
margin: 10px 0;
border: 1px solid #333;
border-radius: 3px;
}

/* NEW STYLES FOR ADDED FEATURES */
.members-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
gap: 20px;
margin: 20px 0;
}
.member-card {
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
padding: 20px;
cursor: pointer;
transition: all 0.3s;
}
.member-card:hover {
border-color: #ff4444;
box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
}
.member-card.admin {
border-color: #ffaa00;
background: #2a1a00;
}
.member-handle {
color: #ff4444;
font-size: 1.1em;
font-weight: bold;
margin-bottom: 10px;
}
.member-stats {
color: #ccc;
font-size: 0.9em;
}
.member-creed {
color: #888;
font-size: 0.8em;
margin-top: 5px;
}
.private-chat-container {
display: grid;
grid-template-columns: 250px 1fr;
gap: 20px;
height: calc(100vh - 200px);
}
.private-chat-list {
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
padding: 15px;
overflow-y: auto;
}
.private-chat-item {
color: #ff4444;
padding: 10px;
cursor: pointer;
border-radius: 3px;
margin-bottom: 5px;
transition: all 0.3s;
border: 1px solid #330000;
}
.private-chat-item:hover, .private-chat-item.active {
background: #330000;
border-color: #ff4444;
}
.private-chat-main {
display: flex;
flex-direction: column;
background: #1a0000;
border: 1px solid #330000;
border-radius: 5px;
}
.private-chat-header {
background: #330000;
padding: 15px;
border-bottom: 1px solid #ff4444;
color: #ff4444;
font-weight: bold;
}
.private-messages {
flex: 1;
padding: 15px;
overflow-y: auto;
max-height: calc(100vh - 350px);
}
.private-message {
margin-bottom: 15px;
padding: 10px;
background: #0a0000;
border-radius: 3px;
border: 1px solid #333;
}
.delete-btn {
background: #660000;
color: #ff4444;
border: 1px solid #ff4444;
padding: 3px 6px;
font-size: 0.7em;
cursor: pointer;
border-radius: 2px;
transition: all 0.3s;
}
.delete-btn:hover {
background: #ff4444;
color: #000;
}
.profile-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
}
.profile-content {
background: #1a0000;
border: 2px solid #ff4444;
border-radius: 5px;
padding: 30px;
max-width: 500px;
width: 90%;
}
.profile-header {
text-align: center;
margin-bottom: 20px;
}
.profile-handle {
color: #ff4444;
font-size: 1.5em;
font-weight: bold;
}
.profile-details {
margin: 20px 0;
}
.profile-details p {
color: #ccc;
margin-bottom: 10px;
}
.settings-section {
background: #0a0000;
border: 1px solid #333;
border-radius: 3px;
padding: 20px;
margin: 20px 0;
}
.server-message-form {
background: #2a1a00;
border: 2px solid #ffaa00;
border-radius: 5px;
padding: 20px;
margin: 20px 0;
}
.private-chats-admin {
max-height: 300px;
overflow-y: auto;
border: 1px solid #333;
border-radius: 3px;
margin: 20px 0;
}
.private-chat-admin {
background: #1a0000;
border-bottom: 1px solid #333;
padding: 15px;
}
.message-actions {
position: absolute;
top: 5px;
right: 5px;
}
.pinned-badge {
background: #ffaa00;
color: #000;
padding: 2px 6px;
border-radius: 3px;
font-size: 0.7em;
}
/* Responsive */
@media (max-width: 768px) {
.decoy-content {
grid-template-columns: 1fr;
}
.chat-interface {
grid-template-columns: 1fr;
height: auto;
}
.chat-rooms {
max-height: 200px;
}
.user-info-admin {
grid-template-columns: 1fr;
}
.private-chat-container {
grid-template-columns: 1fr;
height: auto;
}
.private-chat-list {
max-height: 200px;
}
.members-grid {
grid-template-columns: 1fr;
}
}
</style>
</head>
<body>
<div class="matrix-bg"></div>
<div class="notification-panel"></div>
<!-- Decoy Site -->
<div id="decoy-site" class="decoy-site">
<div class="decoy-header">
<div class="decoy-logo">ANONYMOUS LIBERTY</div>
<div class="decoy-tagline">Defending Digital Rights in the Information Age</div>
</div>
<div class="decoy-nav">
<div class="nav-links">
<a href="#" onclick="showTab('home')" class="nav-link active">Home</a>
<a href="#" onclick="showTab('articles')" class="nav-link">Articles</a>
<a href="#" onclick="showTab('resources')" class="nav-link">Resources</a>
<a href="#" onclick="showTab('contact')" class="nav-link">Contact</a>
</div>
</div>

<div class="container">
<div class="decoy-content">
<div id="main-content">
<div id="home-tab" class="content-tab">
<div class="article">
<h2>Welcome to Anonymous Liberty</h2>
<p>In an age where digital privacy is under constant threat, Anonymous Liberty stands as a
beacon for those who refuse to surrender their fundamental rights to privacy and freedom.</p>
<p>We believe that anonymity is not about hiding wrongdoing, but about preserving the space
for dissent, creativity, and authentic human connection in an increasingly surveilled world.</p>
<h3>Our Mission</h3>
<p>To educate, advocate, and provide tools for individuals seeking to protect their digital privacy
and maintain their anonymity online. We work to ensure that the right to privacy remains a
cornerstone of free society.</p>
<h3>Recent Updates</h3>
<ul>
<li>New guide on secure communication protocols</li>
<li>Analysis of recent privacy legislation changes</li>
<li>Updated recommendations for anonymous browsing</li>
</ul>
</div>
</div>
<div id="articles-tab" class="content-tab hidden">
<div class="article">
<h2>Latest Articles</h2>
<h3>The Surveillance State: A Digital Panopticon</h3>
<p>Exploring how modern surveillance systems create a society where privacy becomes a
luxury only the tech-savvy can afford...</p>
<h3>Cryptography for Activists</h3>
<p>A comprehensive guide to using encryption tools to protect sensitive communications in
high-risk environments...</p>
<h3>The Right to be Forgotten</h3>
<p>Examining the legal and technical challenges of maintaining digital anonymity in an era of
permanent records...</p>
</div>
</div>
<div id="resources-tab" class="content-tab hidden">
<div class="article">
<h2>Privacy Resources</h2>
<h3>Recommended Tools</h3>
<ul>
<li>Secure messaging applications</li>
<li>Anonymous browsing solutions</li>
<li>Privacy-focused operating systems</li>

<li>Encryption software reviews</li>
</ul>
<h3>Educational Materials</h3>
<ul>
<li>Digital security best practices</li>
<li>Understanding metadata</li>
<li>Legal rights and privacy laws</li>
<li>Threat modeling for individuals</li>
</ul>
</div>
</div>
<div id="contact-tab" class="content-tab hidden">
<div class="article">
<h2>Secure Contact</h2>
<p>We understand the importance of secure communications. Use these methods to contact us
anonymously:</p>
<h3>Anonymous Channels</h3>
<p>For sensitive communications, please use our secure channels. All communications are
encrypted and we do not log IP addresses or other identifying information.</p>
<p>Remember: Never use your real name or identifying information when contacting us about
sensitive matters.</p>
</div>
</div>
</div>
<div class="sidebar">
<h3>Access Portal</h3>
<p style="color: #888; margin-bottom: 20px;">Authorized personnel only. Multiple security layers
active.</p>
<div class="auth-tabs">
<button class="auth-tab active" onclick="showAuth('login')">Access</button>
<button class="auth-tab" onclick="showAuth('register')">Register</button>
</div>
<div id="login-form" class="auth-form active">
<form onsubmit="handleLogin(event)">
<div class="form-group">
<label for="handle_number">Handle:</label>
<input type="text" id="handle_number" name="handle_number" required>
</div>
<div class="form-group">
<label for="login_password">Passphrase:</label>
<input type="password" id="login_password" name="password" required>
</div>
<button type="submit" class="btn">AUTHENTICATE</button>
</form>

</div>
<div id="register-form" class="auth-form">
<form onsubmit="handleRegister(event)">
<div class="form-group">
<label for="handle">Handle:</label>
<input type="text" id="handle" name="handle" required maxlength="20">
<small style="color: #888;">Numbers will be auto-assigned</small>
</div>
<div class="form-group">
<label for="email">Contact (optional):</label>
<input type="email" id="email" name="email">
</div>
<div class="form-group">
<label for="creed">Affiliation:</label>
<select id="creed" name="creed">
<option value="">Select...</option>
<option value="firelight">Firelight</option>
<option value="judgment-day">Judgment Day</option>
<option value="triage">Triage</option>
<option value="unity">Unity</option>
<option value="vigil">Vigil</option>
<option value="vitalis">Vitalis</option>
</select>
</div>
<div class="form-group">
<label for="register_password">Passphrase:</label>
<input type="password" id="register_password" name="password" required minlength="8">
</div>
<button type="submit" class="btn">CREATE ACCOUNT</button>
</form>
</div>
</div>
</div>
</div>
</div>
<!-- Hunter-Net Application -->
<div id="hunter-app" class="hunter-app">
<div class="hunter-header">
<div class="hunter-header-content">
<div class="hunter-logo">
<div class="hunter-glyphs">✟ ☩ ⚔</div>
<div class="hunter-title">HUNTER-NET</div>
</div>
<div class="user-info">

<span id="user-display">Connected</span>
<div class="user-stats">
<span>Field Cred: </span><span id="field-cred">0</span>
</div>
<div id="admin-badge" class="admin-badge hidden">WITNESS</div>
<button class="btn btn-danger" onclick="logout()">Disconnect</button>
</div>
</div>
</div>
<div class="hunter-nav">
<div class="hunter-nav-links">
<a href="#" onclick="showHunterSection('boards')" class="hunter-nav-link active">Boards</a>
<a href="#" onclick="showHunterSection('chat')" class="hunter-nav-link">Secure Chat</a>
<a href="#" onclick="showHunterSection('members')" class="hunter-nav-link">Members</a>
<a href="#" onclick="showHunterSection('private-chat')" class="hunter-nav-link">Private Messages</a>
<a href="#" onclick="showHunterSection('account')" class="hunter-nav-link">Account</a>
<a href="#" onclick="showHunterSection('admin')" class="hunter-nav-link" id="admin-nav"
style="display: none;">Admin</a>
</div>
</div>
<div class="hunter-content">

<!-- Members Section -->
<div id="members-section" class="hunter-section hidden">
<h2>Hunter-Net Members</h2>
<div id="members-container" class="members-grid">
<div class="loading">Loading members...</div>
</div>
</div>

<!-- Private Chat Section -->
<div id="private-chat-section" class="hunter-section hidden">
<h2>Private Messages</h2>
<div class="private-chat-container">
<div class="private-chat-list">
<h3>Conversations</h3>
<button class="btn" onclick="showNewPrivateChatForm()">New Chat</button>
<div id="private-chat-list" style="margin-top: 15px;">
<div class="loading">Loading conversations...</div>
</div>
</div>
<div class="private-chat-main" id="private-chat-main">
<div class="private-chat-header" id="private-chat-header">
Select a conversation
</div>
<div class="private-messages" id="private-messages">
<div style="text-align: center; color: #666; padding: 50px;">
Select a conversation to view messages
</div>
</div>
<div class="chat-input">
<input type="text" id="private-chat-input" placeholder="Type your message..." 
onkeypress="handlePrivateChatKeypress(event)" disabled>
<button class="btn" onclick="sendPrivateMessage()" disabled id="send-private-btn">Send</button>
</div>
</div>
</div>
</div>

<!-- Account Section -->
<div id="account-section" class="hunter-section hidden">
<h2>Account Management</h2>
<div class="account-info">
<h4>Account Information</h4>
<p><strong>Handle:</strong> <span id="account-handle">Loading...</span></p>
<p><strong>Field Cred:</strong> <span id="account-field-cred">0</span></p>
<p><strong>Member Status:</strong> <span id="account-status">Active</span></p>
<p><strong>Affiliation:</strong> <span id="account-creed">None</span></p>
</div>

<div class="settings-section">
<h4>Change Password</h4>
<form onsubmit="handleChangePassword(event)">
<div class="form-group">
<label for="current-password">Current Password:</label>
<input type="password" id="current-password" name="currentPassword" required>
</div>
<div class="form-group">
<label for="new-password">New Password:</label>
<input type="password" id="new-password" name="newPassword" required minlength="8">
</div>
<div class="form-group">
<label for="confirm-password">Confirm New Password:</label>
<input type="password" id="confirm-password" name="confirmPassword" required>
</div>
<button type="submit" class="btn">Update Password</button>
</form>
</div>

<div class="settings-section">
<h4>Change Affiliation</h4>
<form onsubmit="handleChangeAffiliation(event)">
<div class="form-group">
<label for="new-creed">New Affiliation:</label>
<select id="new-creed" name="creed">
<option value="">None</option>
<option value="firelight">Firelight</option>
<option value="judgment-day">Judgment Day</option>
<option value="triage">Triage</option>
<option value="unity">Unity</option>
<option value="vigil">Vigil</option>
<option value="vitalis">Vitalis</option>
</select>
</div>
<button type="submit" class="btn">Update Affiliation</button>
</form>
</div>

<div class="danger-zone">
<h3>⚠ Danger Zone</h3>
<p>Permanent account deletion cannot be undone. All posts, threads, and data will be
removed.</p>
<form onsubmit="handleDeleteAccount(event)" style="margin-top: 15px;">
<div class="form-group">
<label for="delete-password">Enter password to confirm:</label>
<input type="password" id="delete-password" name="password" required>
</div>
<div class="form-group">
<label for="delete-reason">Reason (optional):</label>
<textarea id="delete-reason" name="reason" placeholder="Why are you deleting your
account?"></textarea>
</div>
<button type="submit" class="btn btn-danger">DELETE ACCOUNT PERMANENTLY</button>
</form>
</div>
</div>

<!-- Admin Section -->
<div id="admin-section" class="hunter-section hidden">
<div class="admin-panel">
<h2>WITNESS COMMAND CENTER</h2>
<p style="color: #ffaa00;">Full administrative access to Hunter-Net systems</p>
<div style="margin: 20px 0;">
<button class="btn" onclick="loadAdminUsers()">Refresh User List</button>
<button class="btn btn-secondary" onclick="exportSystemData()">Export Data</button>
</div>

<div class="server-message-form">
<h3>Server-Wide Message</h3>
<form onsubmit="handleServerMessage(event)">
<div class="form-group">
<label for="server-message-text">Message:</label>
<textarea id="server-message-text" name="message" required 
placeholder="Enter server-wide announcement..."></textarea>
</div>
<div class="form-group">
<label for="message-type">Type:</label>
<select id="message-type" name="type">
<option value="info">Information</option>
<option value="warning">Warning</option>
<option value="event">Event</option>
<option value="maintenance">Maintenance</option>
</select>
</div>
<button type="submit" class="btn">Send to All Members</button>
</form>
</div>

<h3>Private Conversations Monitor</h3>
<div id="admin-private-chats" class="private-chats-admin">
<div class="loading">Click to load private conversations...</div>
</div>
<button class="btn btn-secondary" onclick="loadAdminPrivateChats()">Load Private Chats</button>

<h3>User Management</h3>
<div id="admin-users-container" class="user-list">
<div class="loading">Click Refresh to load users...</div>
</div>
</div>
</div>
<!-- Boards Section -->
<div id="boards-section" class="hunter-section">
<div id="board-list-view">
<h2>Hunter-Net Boards</h2>
<div id="boards-container" class="board-list">
<div class="loading">Loading boards...</div>
</div>
</div>
<div id="thread-list-view" class="hidden">
<div class="breadcrumb">
<a href="#" onclick="showBoardList()">Boards</a> &gt; <span
id="current-board-name"></span>
</div>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:
20px;">
<h2 id="board-title"></h2>
<button class="btn" onclick="showNewThreadForm()">New Thread</button>
</div>
<div id="threads-container" class="thread-list">
<div class="loading">Loading threads...</div>
</div>
</div>
<div id="thread-view" class="hidden">
<div class="breadcrumb">
<a href="#" onclick="showBoardList()">Boards</a> &gt;
<a href="#" onclick="showThreadList()" id="breadcrumb-board"></a> &gt;
<span id="current-thread-title"></span>
</div>
<div id="thread-content"></div>
<div id="posts-container"></div>
<div class="form-container">
<h3>Reply to Thread</h3>
<form onsubmit="handleNewPost(event)">
<div class="form-group">
<label for="post-body">Message:</label>
<textarea id="post-body" name="body_md" required></textarea>
</div>
<div class="form-group">
<label for="post-image">Image (optional):</label>
<input type="file" id="post-image" accept="image/*" onchange="previewImage(event,
'post-preview')">
<img id="post-preview" class="image-preview hidden">
</div>
<button type="submit" class="btn">Post Reply</button>
</form>
</div>
</div>
<div id="new-thread-form" class="hidden">
<div class="breadcrumb">
<a href="#" onclick="showBoardList()">Boards</a> &gt;
<a href="#" onclick="showThreadList()" id="breadcrumb-board-2"></a> &gt;
New Thread
</div>
<div class="form-container">
<h2>Create New Thread</h2>
<form onsubmit="handleNewThread(event)">
<div class="form-group">
<label for="thread-title">Title:</label>
<input type="text" id="thread-title" name="title" required>
</div>
<div class="form-group">
<label for="thread-signal">Signal Type:</label>
<select id="thread-signal" name="signal">
<option value="">Select...</option>
<option value="sighting">Sighting</option>
<option value="intel">Intel</option>
<option value="request-aid">Request Aid</option>
<option value="after-action">After Action</option>
<option value="caution">Caution</option>
</select>
</div>

<div class="form-group">
<label for="thread-tags">Tags:</label>
<input type="text" id="thread-tags" name="tags" placeholder="vampire, chicago, urgent">
</div>
<div class="form-group">
<label for="thread-body">Message:</label>
<textarea id="thread-body" name="body_md" required></textarea>
</div>
<div class="form-group">
<label for="thread-image">Image (optional):</label>
<input type="file" id="thread-image" accept="image/*" onchange="previewImage(event,
'thread-preview')">
<img id="thread-preview" class="image-preview hidden">
</div>
<button type="submit" class="btn">Create Thread</button>
<button type="button" class="btn btn-secondary" onclick="showThreadList()">Cancel</button>
</form>
</div>
</div>
</div>
<!-- Chat Section -->
<div id="chat-section" class="hunter-section hidden">
<h2>Secure Communications</h2>
<div class="chat-interface">
<div class="chat-rooms">
<h3>Channels</h3>
<div id="chat-rooms-list"></div>
</div>
<div class="chat-main">
<div class="chat-messages" id="chat-messages"></div>
<div class="chat-input">
<input type="text" id="chat-input" placeholder="Enter message..."
onkeypress="handleChatKeypress(event)">
<button class="btn" onclick="sendChatMessage()">Send</button>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Profile Modal -->
<div id="profile-modal" class="profile-modal hidden">
<div class="profile-content">
<div class="profile-header">
<div class="profile-handle" id="profile-handle">Loading...</div>
<button class="btn btn-secondary" onclick="closeProfile()" style="float: right; margin-top: -40px;">×</button>
</div>
<div class="profile-details">
<p><strong>Field Cred:</strong> <span id="profile-field-cred">0</span></p>
<p><strong>Affiliation:</strong> <span id="profile-creed">None</span></p>
<p><strong>Member Since:</strong> <span id="profile-joined">Unknown</span></p>
<p><strong>Threads Created:</strong> <span id="profile-threads">0</span></p>
<p><strong>Posts Made:</strong> <span id="profile-posts">0</span></p>
</div>
<div style="text-align: center; margin-top: 20px;">
<button class="btn" onclick="startPrivateChat()">Send Private Message</button>
</div>
</div>
</div>

<!-- New Private Chat Modal -->
<div id="new-private-chat-modal" class="profile-modal hidden">
<div class="profile-content">
<div class="profile-header">
<h3>Start New Private Chat</h3>
<button class="btn btn-secondary" onclick="closeNewPrivateChatForm()" style="float: right; margin-top: -40px;">×</button>
</div>
<form onsubmit="handleNewPrivateChat(event)">
<div class="form-group">
<label for="chat-recipient">Recipient Handle:</label>
<input type="text" id="chat-recipient" name="recipient" required 
placeholder="Enter handle (e.g., hunter123)">
</div>
<div class="form-group">
<label for="initial-message">Initial Message:</label>
<textarea id="initial-message" name="message" required 
placeholder="Start the conversation..."></textarea>
</div>
<button type="submit" class="btn">Start Chat</button>
</form>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
<script>
// Global state
let currentUser = null;
let currentBoard = null;
let currentThread = null;
let socket = null;
let currentChatRoom = 'global';
let chatMessages = {}; // Store messages by room
let currentPrivateChat = null;
let privateChats = {};

// Client storage utility (using memory instead of localStorage)
const hunterStorage = {
data: {},
set(key, value) {
try {
this.data[key] = JSON.stringify(value);
return true;
} catch (error) {
console.error('Storage error:', error);
return false;
}
},
get(key, defaultValue = null) {
try {
const item = this.data[key];
return item ? JSON.parse(item) : defaultValue;
} catch (error) {
console.error('Storage error:', error);
return defaultValue;
}
},
remove(key) {
try {
delete this.data[key];
return true;
} catch (error) {
console.error('Storage error:', error);
return false;
}
},
storeVote(targetType, targetId, voteData) {
const votes = this.get('votes', {});
const key = `${targetType}_${targetId}`;
votes[key] = voteData;
this.set('votes', votes);
},
getVote(targetType, targetId) {
const votes = this.get('votes', {});
const key = `${targetType}_${targetId}`;
return votes[key] || null;
}
};

// API helpers
async function apiRequest(url, options = {}) {
try {
const response = await fetch(url, {
credentials: 'include',
...options,
headers: {
'Content-Type': 'application/json',
...options.headers
}
});
if (!response.ok) {
const error = await response.json().catch(() => ({ error: 'Request failed' }));
throw new Error(error.error || `HTTP ${response.status}`);
}
return response.json();
} catch (error) {
console.error('API Request failed:', error);
throw error;
}
}

// Fixed upload helper with better error handling
async function uploadImage(file) {
if (!file) return null;

// Validate file
if (file.size > 5 * 1024 * 1024) {
throw new Error('Image too large. Maximum 5MB allowed.');
}
if (!file.type.startsWith('image/')) {
throw new Error('Only image files are allowed.');
}

const formData = new FormData();
formData.append('image', file);

try {
const response = await fetch('/api/upload', {
method: 'POST',
credentials: 'include',
body: formData
});

if (!response.ok) {
const errorData = await response.json().catch(() => ({}));
throw new Error(errorData.error || `Upload failed: ${response.status}`);
}

const data = await response.json();
return data.image_path;
} catch (error) {
console.error('Upload error:', error);
throw error;
}
}

// Image preview
function previewImage(event, previewId) {
const file = event.target.files[0];
const preview = document.getElementById(previewId);
if (file) {
// Validate file size (5MB limit)
if (file.size > 5 * 1024 * 1024) {
showNotification('Image too large. Maximum 5MB allowed.', 'error');
event.target.value = '';
preview.classList.add('hidden');
return;
}
// Validate file type
if (!file.type.startsWith('image/')) {
showNotification('Only image files are allowed.', 'error');
event.target.value = '';
preview.classList.add('hidden');
return;
}
const reader = new FileReader();
reader.onload = function(e) {
preview.src = e.target.result;
preview.classList.remove('hidden');
};
reader.readAsDataURL(file);
} else {
preview.classList.add('hidden');
}
}

// Voting system
async function vote(targetType, targetId, voteType) {
try {
const data = await apiRequest('/api/vote', {
method: 'POST',
body: JSON.stringify({
target_type: targetType,
target_id: targetId,
vote_type: voteType
})
});
// Store vote locally
hunterStorage.storeVote(targetType, targetId, {
user_vote: voteType,
upvotes: data.upvotes,
downvotes: data.downvotes
});
updateVoteDisplay(targetType, targetId, {
user_vote: voteType,
upvotes: data.upvotes,
downvotes: data.downvotes
});
showNotification(`Vote ${voteType === 'up' ? 'up' : 'down'} recorded`, 'success');
} catch (error) {
showNotification(error.message, 'error');
}
}

function updateVoteDisplay(targetType, targetId, voteData) {
const voteContainer = document.getElementById(`vote-${targetType}-${targetId}`);
if (voteContainer) {
const upBtn = voteContainer.querySelector('.vote-up');
const downBtn = voteContainer.querySelector('.vote-down');
const upCount = voteContainer.querySelector('.up-count');
const downCount = voteContainer.querySelector('.down-count');
// Update button states
upBtn.classList.toggle('active-up', voteData.user_vote === 'up');
downBtn.classList.toggle('active-down', voteData.user_vote === 'down');
// Update counts
upCount.textContent = voteData.upvotes;
downCount.textContent = voteData.downvotes;
}
}

function createVoteControls(targetType, targetId, voteData = {}) {
return `
<div id="vote-${targetType}-${targetId}" class="vote-controls">
<button class="vote-btn vote-up ${voteData.user_vote === 'up' ? 'active-up' : ''}"
onclick="vote('${targetType}', ${targetId}, 'up')">
▲ <span class="up-count">${voteData.upvotes || 0}</span>
</button>
<button class="vote-btn vote-down ${voteData.user_vote === 'down' ? 'active-down' : ''}"
onclick="vote('${targetType}', ${targetId}, 'down')">
▼ <span class="down-count">${voteData.downvotes || 0}</span>
</button>
</div>
`;
}

// Notification system
function showNotification(message, type = 'info') {
const notification = document.createElement('div');
notification.className = `notification ${type}`;
notification.textContent = message;
notification.onclick = () => notification.remove();
document.querySelector('.notification-panel').appendChild(notification);
setTimeout(() => {
if (notification.parentNode) {
notification.remove();
}
}, 5000);
}

// Tab switching for decoy site
function showTab(tabName) {
document.querySelectorAll('.content-tab').forEach(tab => tab.classList.add('hidden'));
document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
const targetTab = document.getElementById(`${tabName}-tab`);
if (targetTab) {
targetTab.classList.remove('hidden');
}
event.target.classList.add('active');
}

// Auth tab switching
function showAuth(authType) {
document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
const targetForm = document.getElementById(`${authType}-form`);
if (targetForm) {
targetForm.classList.add('active');
}
event.target.classList.add('active');
}

// Authentication handlers
async function handleLogin(event) {
event.preventDefault();
const formData = new FormData(event.target);
try {
showNotification('Authenticating...', 'info');
const data = await apiRequest('/api/login', {
method: 'POST',
body: JSON.stringify({
handle_number: formData.get('handle_number'),
password: formData.get('password')
})
});
currentUser = data.user;
initializeHunterNet();
showNotification('Access granted. Welcome to Hunter-Net.', 'success');
} catch (error) {
showNotification(error.message, 'error');
}
}

async function handleRegister(event) {
event.preventDefault();
const formData = new FormData(event.target);
try {
showNotification('Creating account...', 'info');
const data = await apiRequest('/api/register', {
method: 'POST',
body: JSON.stringify({
handle: formData.get('handle'),
email: formData.get('email') || undefined,
password: formData.get('password'),
creed: formData.get('creed') || undefined
})
});
currentUser = data.user;
initializeHunterNet();
showNotification(`Account created. Welcome ${data.user.handle_number}`, 'success');
} catch (error) {
showNotification(error.message, 'error');
}
}

// NEW FUNCTIONS FOR ADDED FEATURES

// Change password
async function handleChangePassword(event) {
event.preventDefault();
const formData = new FormData(event.target);
const newPassword = formData.get('newPassword');
const confirmPassword = formData.get('confirmPassword');

if (newPassword !== confirmPassword) {
showNotification('New passwords do not match', 'error');
return;
}

try {
await apiRequest('/api/account/password', {
method: 'PATCH',
body: JSON.stringify({
current_password: formData.get('currentPassword'),
new_password: newPassword
})
});
showNotification('Password updated successfully', 'success');
event.target.reset();
} catch (error) {
showNotification(error.message, 'error');
}
}

// Change affiliation
async function handleChangeAffiliation(event) {
event.preventDefault();
const formData = new FormData(event.target);
try {
const data = await apiRequest('/api/account/affiliation', {
method: 'PATCH',
body: JSON.stringify({
creed: formData.get('creed')
})
});
currentUser.creed = data.creed;
document.getElementById('account-creed').textContent = data.creed || 'None';
showNotification('Affiliation updated successfully', 'success');
} catch (error) {
showNotification(error.message, 'error');
}
}

// Load members
async function loadMembers() {
try {
const data = await apiRequest('/api/members');
displayMembers(data.members);
} catch (error) {
document.getElementById('members-container').innerHTML = `
<div class="error">Failed to load members: ${error.message}</div>
`;
}
}

function displayMembers(members) {
// Sort members: admin first, then by creation date
members.sort((a, b) => {
if (a.handle_number === 'witness1') return -1;
if (b.handle_number === 'witness1') return 1;
return new Date(a.created_at) - new Date(b.created_at);
});

const container = document.getElementById('members-container');
container.innerHTML = members.map(member => `
<div class="member-card ${member.is_admin ? 'admin' : ''}" onclick="showMemberProfile('${member.handle_number}')">
<div class="member-handle">
${member.handle_number}
${member.is_admin ? ' <span style="color: #ffaa00;">[WITNESS]</span>' : ''}
</div>
<div class="member-stats">
<div>Field Cred: ${member.field_cred}</div>
<div>Threads: ${member.thread_count || 0} | Posts: ${member.post_count || 0}</div>
</div>
<div class="member-creed">
${member.creed ? `Affiliation: ${member.creed}` : 'No affiliation'}
</div>
</div>
`).join('');
}

// Show member profile
async function showMemberProfile(handleNumber) {
try {
const data = await apiRequest(`/api/members/${handleNumber}`);
const member = data.member;

document.getElementById('profile-handle').textContent = member.handle_number;
document.getElementById('profile-field-cred').textContent = member.field_cred;
document.getElementById('profile-creed').textContent = member.creed || 'None';
document.getElementById('profile-joined').textContent = new Date(member.created_at).toLocaleDateString();
document.getElementById('profile-threads').textContent = member.thread_count || 0;
document.getElementById('profile-posts').textContent = member.post_count || 0;

// Store for private chat
document.getElementById('profile-modal').dataset.handle = member.handle_number;
document.getElementById('profile-modal').classList.remove('hidden');
} catch (error) {
showNotification(error.message, 'error');
}
}

function closeProfile() {
document.getElementById('profile-modal').classList.add('hidden');
}

// Private chat functions
function showNewPrivateChatForm() {
document.getElementById('new-private-chat-modal').classList.remove('hidden');
}

function closeNewPrivateChatForm() {
document.getElementById('new-private-chat-modal').classList.add('hidden');
}

function startPrivateChat() {
const handle = document.getElementById('profile-modal').dataset.handle;
if (handle) {
document.getElementById('chat-recipient').value = handle;
closeProfile();
showNewPrivateChatForm();
}
}

async function handleNewPrivateChat(event) {
event.preventDefault();
const formData = new FormData(event.target);
try {
const data = await apiRequest('/api/private-chats', {
method: 'POST',
body: JSON.stringify({
recipient: formData.get('recipient'),
message: formData.get('message')
})
});
showNotification('Private chat started', 'success');
closeNewPrivateChatForm();
event.target.reset();
loadPrivateChats();
} catch (error) {
showNotification(error.message, 'error');
}
}

async function loadPrivateChats() {
try {
const data = await apiRequest('/api/private-chats');
displayPrivateChats(data.chats);
} catch (error) {
document.getElementById('private-chat-list').innerHTML = `
<div class="error">Failed to load chats: ${error.message}</div>
`;
}
}

function displayPrivateChats(chats) {
const container = document.getElementById('private-chat-list');
container.innerHTML = chats.map(chat => `
<div class="private-chat-item" onclick="loadPrivateChat('${chat.id}', '${chat.other_user}')">
${chat.other_user}
${chat.unread_count > 0 ? `<span style="background: #ff4444; color: #fff; padding: 2px 6px; border-radius: 10px; font-size: 0.7em; margin-left: 5px;">${chat.unread_count}</span>` : ''}
</div>
`).join('');
}

async function loadPrivateChat(chatId, otherUser) {
currentPrivateChat = chatId;
document.getElementById('private-chat-header').textContent = `Chat with ${otherUser}`;

// Enable input
document.getElementById('private-chat-input').disabled = false;
document.getElementById('send-private-btn').disabled = false;

// Update active chat
document.querySelectorAll('.private-chat-item').forEach(item => item.classList.remove('active'));
event.target.classList.add('active');

try {
const data = await apiRequest(`/api/private-chats/${chatId}/messages`);
displayPrivateMessages(data.messages);
} catch (error) {
showNotification(error.message, 'error');
}
}

function displayPrivateMessages(messages) {
const container = document.getElementById('private-messages');
container.innerHTML = messages.map(message => `
<div class="private-message">
<div class="post-header">
<span class="post-author">${message.sender}</span>
<span class="post-time">${new Date(message.created_at).toLocaleString()}</span>
${message.sender === currentUser.handle_number ? `
<div class="message-actions">
<button class="delete-btn" onclick="deletePrivateMessage(${message.id})">Delete</button>
</div>
` : ''}
</div>
<div class="post-body">${message.body}</div>
${message.image_path ? `<img src="${message.image_path}" class="image-preview">` : ''}
</div>
`).join('');
container.scrollTop = container.scrollHeight;
}

async function sendPrivateMessage() {
if (!currentPrivateChat) return;
const input = document.getElementById('private-chat-input');
const message = input.value = '';
loadPrivateChat(currentPrivateChat, document.getElementById('private-chat-header').textContent.replace('Chat with ', ''));
} catch (error) {
showNotification(error.message, 'error');
}
}

function handlePrivateChatKeypress(event) {
if (event.key === 'Enter') {
sendPrivateMessage();
}
}

async function deletePrivateMessage(messageId) {
if (!confirm('Delete this message?')) return;
try {
await apiRequest(`/api/private-messages/${messageId}`, {
method: 'DELETE'
});
// Reload current chat
if (currentPrivateChat) {
loadPrivateChat(currentPrivateChat, document.getElementById('private-chat-header').textContent.replace('Chat with ', ''));
}
showNotification('Message deleted', 'success');
} catch (error) {
showNotification(error.message, 'error');
}
}

// Delete functions for posts/threads
async function deletePost(postId) {
if (!confirm('Delete this post?')) return;
try {
await apiRequest(`/api/posts/${postId}`, {
method: 'DELETE'
});
showNotification('Post deleted', 'success');
// Reload current thread
if (currentThread) {
loadThread(currentThread.id, currentThread.title);
}
} catch (error) {
showNotification(error.message, 'error');
}
}

async function deleteThread(threadId) {
if (!confirm('Delete this thread?')) return;
try {
await apiRequest(`/api/threads/${threadId}`, {
method: 'DELETE'
});
showNotification('Thread deleted', 'success');
// Go back to thread list
showThreadList();
if (currentBoard) {
loadThreads(currentBoard.key, currentBoard.name);
}
} catch (error) {
showNotification(error.message, 'error');
}
}

async function deleteChatMessage(messageId) {
if (!confirm('Delete this message?')) return;
try {
await apiRequest(`/api/chat-messages/${messageId}`, {
method: 'DELETE'
});
showNotification('Message deleted', 'success');
// Reload chat messages
loadChatMessages(currentChatRoom);
} catch (error) {
showNotification(error.message, 'error');
}
}

// Account deletion handler
async function handleDeleteAccount(event) {
event.preventDefault();
const formData = new FormData(event.target);
const password = formData.get('password');
const reason = formData.get('reason');
if (!confirm('Are you ABSOLUTELY sure you want to delete your account? This cannot be undone!')) {
return;
}
try {
showNotification('Deleting account...', 'info');
await apiRequest('/api/account', {
method: 'DELETE',
body: JSON.stringify({
password: password,
reason: reason || 'User requested deletion'
})
});
showNotification('Account deleted successfully. You will be disconnected.', 'success');
setTimeout(() => {
logout();
}, 2000);
} catch (error) {
showNotification(error.message, 'error');
}
}

function logout() {
currentUser = null;
currentBoard = null;
currentThread = null;
currentPrivateChat = null;
chatMessages = {};
privateChats = {};
if (socket) {
socket.disconnect();
socket = null;
}
apiRequest('/api/logout', { method: 'POST' }).catch(() => {});
document.getElementById('decoy-site').style.display = 'block';
document.getElementById('hunter-app').style.display = 'none';
showNotification('Disconnected from Hunter-Net.', 'info');
}

// Hunter-Net initialization
function initializeHunterNet() {
document.getElementById('decoy-site').style.display = 'none';
document.getElementById('hunter-app').style.display = 'block';

document.getElementById('user-display').textContent = currentUser.handle_number;
document.getElementById('field-cred').textContent = currentUser.field_cred || 0;

// Update account section
document.getElementById('account-handle').textContent = currentUser.handle_number;
document.getElementById('account-field-cred').textContent = currentUser.field_cred || 0;
document.getElementById('account-creed').textContent = currentUser.creed || 'None';

// Set current affiliation in dropdown
document.getElementById('new-creed').value = currentUser.creed || '';

// Show admin features only for witness1
if (currentUser.handle_number === 'witness1') {
document.getElementById('admin-nav').style.display = 'block';
document.getElementById('admin-badge').classList.remove('hidden');
}

// Initialize Socket.IO connection
try {
socket = io({
transports: ['websocket', 'polling'],
auth: {
token: document.cookie.split('; ').find(row => row.startsWith('token='))?.split('=')[1]
}
});

socket.on('connect', () => {
console.log('Connected to chat server');
showNotification('Chat server connected', 'success');
});

socket.on('message', (data) => {
displayChatMessage(data);
if (!chatMessages[currentChatRoom]) {
chatMessages[currentChatRoom] = [];
}
chatMessages[currentChatRoom].push(data);
});

socket.on('disconnect', () => {
console.log('Disconnected from chat server');
showNotification('Chat server disconnected', 'error');
});

socket.on('connect_error', (error) => {
console.error('Socket connection error:', error);
showNotification('Chat connection failed', 'error');
});
} catch (error) {
console.error('Socket.IO initialization failed:', error);
showNotification('Chat system unavailable', 'error');
}

loadBoards();
loadChatRooms();
loadMembers();
loadPrivateChats();
}

// Hunter-Net navigation
function showHunterSection(sectionName) {
document.querySelectorAll('.hunter-section').forEach(section => section.classList.add('hidden'));
document.querySelectorAll('.hunter-nav-link').forEach(link => link.classList.remove('active'));

const targetSection = document.getElementById(`${sectionName}-section`);
if (targetSection) {
targetSection.classList.remove('hidden');
}
event.target.classList.add('active');

if (sectionName === 'chat') {
if (socket && socket.connected) {
socket.emit('join', currentChatRoom);
}
loadChatMessages(currentChatRoom);
} else if (sectionName === 'members') {
loadMembers();
} else if (sectionName === 'private-chat') {
loadPrivateChats();
}
}

// ADMIN FUNCTIONS

// Server message
async function handleServerMessage(event) {
event.preventDefault();
const formData = new FormData(event.target);
try {
await apiRequest('/api/admin/server-message', {
method: 'POST',
body: JSON.stringify({
message: formData.get('message'),
type: formData.get('type')
})
});
showNotification('Server message sent to all members', 'success');
event.target.reset();
} catch (error) {
showNotification(error.message, 'error');
}
}

// Load private chats for admin
async function loadAdminPrivateChats() {
try {
const data = await apiRequest('/api/admin/private-chats');
displayAdminPrivateChats(data.chats);
} catch (error) {
document.getElementById('admin-private-chats').innerHTML = `
<div class="error">Failed to load private chats: ${error.message}</div>
`;
}
}

function displayAdminPrivateChats(chats) {
const container = document.getElementById('admin-private-chats');
container.innerHTML = chats.map(chat => `
<div class="private-chat-admin">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
<strong style="color: #ff4444;">${chat.user1} ↔ ${chat.user2}</strong>
<div>
<button class="btn btn-small" onclick="viewAdminPrivateChat(${chat.id}, '${chat.user1}', '${chat.user2}')">View</button>
<button class="btn btn-danger btn-small" onclick="joinPrivateChat(${chat.id})">Join Chat</button>
</div>
</div>
<div style="color: #888; font-size: 0.8em;">
Messages: ${chat.message_count} | Last: ${new Date(chat.last_message_at).toLocaleDateString()}
</div>
</div>
`).join('');
}

async function viewAdminPrivateChat(chatId, user1, user2) {
try {
const data = await apiRequest(`/api/admin/private-chats/${chatId}/messages`);

const messages = data.messages.map(msg => `
<div style="margin: 10px 0; padding: 10px; background: #0a0000; border-radius: 3px;">
<strong style="color: #ff4444;">${msg.sender}:</strong> ${msg.body}
<div style="color: #666; font-size: 0.7em; margin-top: 5px;">
${new Date(msg.created_at).toLocaleString()}
</div>
</div>
`).join('');

const newWindow = window.open('', '_blank', 'width=600,height=400,scrollbars=yes');
newWindow.document.write(`
<html>
<head><title>Private Chat: ${user1} ↔ ${user2}</title>
<style>body { font-family: 'Courier New', monospace; background: #0a0a0a; color: #ff4444; padding: 20px; }</style>
</head>
<body>
<h2>Private Chat: ${user1} ↔ ${user2}</h2>
${messages}
</body>
</html>
`);
} catch (error) {
showNotification(error.message, 'error');
}
}

async function joinPrivateChat(chatId) {
if (!confirm('Join this private chat? Both users will be notified.')) return;
try {
await apiRequest(`/api/admin/private-chats/${chatId}/join`, {
method: 'POST'
});
showNotification('Joined private chat', 'success');
loadPrivateChats();
} catch (error) {
showNotification(error.message, 'error');
}
}

async function loadAdminUsers() {
try {
const data = await apiRequest('/api/admin/users');
displayAdminUsers(data.users);
} catch (error) {
document.getElementById('admin-users-container').innerHTML = `
<div class="error">Failed to load users: ${error.message}</div>
`;
}
}

function displayAdminUsers(users) {
const container = document.getElementById('admin-users-container');
container.innerHTML = users.map(user => `
<div class="user-item">
<div class="user-info-admin">
<div>
<strong style="color: #ff4444;">${user.handle_number}</strong>
${user.active === 'deleted' ? '<span style="color: #666;"> [DELETED]</span>' : ''}
<br>
<small style="color: #888;">${user.creed || 'No creed'} | Joined ${new Date(user.created_at).toLocaleDateString()}</small>
</div>
<div>
<strong>Field Cred:</strong> ${user.field_cred}<br>
<small>Threads: ${user.thread_count} | Posts: ${user.post_count}</small>
</div>
<div>
${user.email ? `<small style="color: #888;">${user.email}</small>` : ''}
${user.deletion_reason ? `<br><small style="color: #ff4444;">Deleted: ${user.deletion_reason}</small>` : ''}
</div>
</div>
<div class="user-actions">
${user.active !== 'deleted' ? `
<button class="btn btn-small" onclick="adjustFieldCred(${user.id})">Adjust Cred</button>
<button class="btn btn-danger btn-small" onclick="adminDeleteUser(${user.id})">Delete</button>
<button class="btn btn-secondary btn-small" onclick="strikeUser(${user.id})">Strike</button>
` : ''}
</div>
</div>
`).join('');
}

async function adjustFieldCred(userId) {
const newCred = prompt('Enter new field cred value:');
const reason = prompt('Reason for adjustment:');
if (newCred !== null && !isNaN(newCred)) {
try {
await apiRequest(`/api/admin/users/${userId}/field-cred`, {
method: 'PATCH',
body: JSON.stringify({
field_cred: parseInt(newCred),
reason: reason || 'Admin adjustment'
})
});
showNotification('Field cred updated successfully', 'success');
loadAdminUsers();
} catch (error) {
showNotification(error.message, 'error');
}
}
}

async function adminDeleteUser(userId) {
const reason = prompt('Reason for deletion:');
if (reason && confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
try {
await apiRequest(`/api/admin/users/${userId}`, {
method: 'DELETE',
body: JSON.stringify({ reason })
});
showNotification('User deleted successfully', 'success');
loadAdminUsers();
} catch (error) {
showNotification(error.message, 'error');
}
}
}

async function strikeUser(userId) {
const reason = prompt('Reason for strike:');
if (reason) {
try {
await apiRequest(`/api/admin/users/${userId}/strike`, {
method: 'POST',
body: JSON.stringify({ reason })
});
showNotification('Strike issued successfully', 'success');
loadAdminUsers();
} catch (error) {
showNotification(error.message, 'error');
}
}
}

function exportSystemData() {
const data = {
storage: hunterStorage.data,
chatMessages: chatMessages,
privateChats: privateChats,
timestamp: new Date().toISOString(),
user: currentUser.handle_number
};
const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `hunternet-export-${Date.now()}.json`;
a.click();
URL.revokeObjectURL(url);
showNotification('System data exported', 'success');
}

// Board functions
async function loadBoards() {
try {
const data = await apiRequest('/api/boards');
displayBoards(data.boards);
} catch (error) {
document.getElementById('boards-container').innerHTML = `<div class="error">Failed to load boards: ${error.message}</div>`;
}
}

function displayBoards(boards) {
const container = document.getElementById('boards-container');
container.innerHTML = boards.map(board => `
<div class="board-card" onclick="loadThreads('${board.key}', '${board.name}')">
<div class="board-title">${board.name}</div>
<div class="board-description">${board.description}</div>
</div>
`).join('');
}

async function loadThreads(boardKey, boardName) {
currentBoard = { key: boardKey, name: boardName };
document.getElementById('board-list-view').classList.add('hidden');
document.getElementById('thread-list-view').classList.remove('hidden');
document.getElementById('current-board-name').textContent = boardName;
document.getElementById('board-title').textContent = boardName;
document.getElementById('breadcrumb-board').textContent = boardName;
document.getElementById('breadcrumb-board-2').textContent = boardName;

try {
const data = await apiRequest(`/api/boards/${boardKey}/threads`);
displayThreads(data.threads);
} catch (error) {
document.getElementById('threads-container').innerHTML = `<div class="error">Failed to load threads: ${error.message}</div>`;
}
}

function displayThreads(threads) {
const container = document.getElementById('threads-container');
container.innerHTML = threads.map(thread => {
const voteData = hunterStorage.getVote('thread', thread.id) || {
upvotes: thread.upvotes,
downvotes: thread.downvotes,
user_vote: null
};

const canDelete = thread.author === currentUser.handle_number || currentUser.handle_number === 'witness1';

return `
<div class="thread-item ${thread.sticky ? 'sticky' : ''} ${thread.locked ? 'locked' : ''}"
onclick="loadThread(${thread.id}, '${thread.title}')">
<div class="thread-title">
${thread.sticky ? '📌 ' : ''}
${thread.locked ? '🔒 ' : ''}
${thread.title}
${canDelete ? `<button class="delete-btn" onclick="event.stopPropagation(); deleteThread(${thread.id})" style="float: right;">Delete</button>` : ''}
</div>
<div class="thread-meta">
<span>by <span class="post-author" onclick="event.stopPropagation(); showMemberProfile('${thread.author}')">${thread.author}</span></span>
<span>${new Date(thread.created_at).toLocaleDateString()}</span>
<span>${thread.post_count} replies</span>
${thread.signal_type ? `<span class="signal-badge">${thread.signal_type}</span>` : ''}
${thread.tags ? `<span>Tags: ${thread.tags}</span>` : ''}
</div>
${createVoteControls('thread', thread.id, voteData)}
</div>
`;
}).join('');
}

async function loadThread(threadId, threadTitle) {
currentThread = { id: threadId, title: threadTitle };
document.getElementById('thread-list-view').classList.add('hidden');
document.getElementById('thread-view').classList.remove('hidden');
document.getElementById('current-thread-title').textContent = threadTitle;

try {
const data = await apiRequest(`/api/threads/${threadId}`);
displayThread(data.thread, data.posts);
} catch (error) {
document.getElementById('thread-content').innerHTML = `<div class="error">Failed to load thread: ${error.message}</div>`;
}
}

function displayThread(thread, posts) {
const threadVoteData = hunterStorage.getVote('thread', thread.id) || {
upvotes: thread.upvotes,
downvotes: thread.downvotes,
user_vote: null
};

const canDeleteThread = thread.author === currentUser.handle_number || currentUser.handle_number === 'witness1';

const threadContent = document.getElementById('thread-content');
threadContent.innerHTML = `
<div class="thread-content">
<h2>${thread.title}</h2>
<div class="thread-meta">
<span>by <span class="post-author" onclick="showMemberProfile('${thread.author}')">${thread.author}</span></span>
<span>${new Date(thread.created_at).toLocaleDateString()}</span>
${thread.signal_type ? `<span class="signal-badge">${thread.signal_type}</span>` : ''}
${thread.tags ? `<span>Tags: ${thread.tags}</span>` : ''}
${currentUser.handle_number === 'witness1' ? `
<button class="btn btn-secondary btn-small" onclick="toggleSticky(${thread.id}, ${!thread.sticky})">${thread.sticky ? 'Unstick' : 'Stick'}</button>
<button class="btn btn-secondary btn-small" onclick="toggleLocked(${thread.id}, ${!thread.locked})">${thread.locked ? 'Unlock' : 'Lock'}</button>
<button class="btn btn-secondary btn-small" onclick="togglePinned(${thread.id}, ${!thread.pinned})">${thread.pinned ? 'Unpin' : 'Pin'}</button>
` : ''}
${canDeleteThread ? `<button class="delete-btn" onclick="deleteThread(${thread.id})">Delete Thread</button>` : ''}
</div>
<div class="post-body">${thread.body_md}</div>
${thread.image_path ? `<img src="${thread.image_path}" class="image-preview">` : ''}
${createVoteControls('thread', thread.id, threadVoteData)}
</div>
`;

const postsContainer = document.getElementById('posts-container');
postsContainer.innerHTML = posts.map(post => {
const postVoteData = hunterStorage.getVote('post', post.id) || {
upvotes: post.upvotes,
downvotes: post.downvotes,
user_vote: null
};

const canDeletePost = post.author === currentUser.handle_number || currentUser.handle_number === 'witness1';

return `
<div class="post-item">
<div class="post-header">
<span class="post-author" onclick="showMemberProfile('${post.author}')">${post.author}</span>
<span class="post-time">${new Date(post.created_at).toLocaleString()}</span>
${canDeletePost ? `
<div class="message-actions">
<button class="delete-btn" onclick="deletePost(${post.id})">Delete</button>
</div>
` : ''}
</div>
<div class="post-body">${post.body_md}</div>
${post.image_path ? `<img src="${post.image_path}" class="image-preview">` : ''}
${createVoteControls('post', post.id, postVoteData)}
</div>
`;
}).join('');
}

function showBoardList() {
document.getElementById('thread-list-view').classList.add('hidden');
document.getElementById('thread-view').classList.add('hidden');
document.getElementById('new-thread-form').classList.add('hidden');
document.getElementById('board-list-view').classList.remove('hidden');
currentBoard = null;
currentThread = null;
}

function showThreadList() {
if (!currentBoard) {
showBoardList();
return;
}
document.getElementById('thread-view').classList.add('hidden');
document.getElementById('new-thread-form').classList.add('hidden');
document.getElementById('thread-list-view').classList.remove('hidden');
currentThread = null;
}

function showNewThreadForm() {
document.getElementById('thread-list-view').classList.add('hidden');
document.getElementById('new-thread-form').classList.remove('hidden');
}

// Fixed thread creation with proper image upload
async function handleNewThread(event) {
event.preventDefault();
const formData = new FormData(event.target);
try {
showNotification('Creating thread...', 'info');
let imagePath = null;
const imageFile = document.getElementById('thread-image').files[0];
if (imageFile) {
showNotification('Uploading image...', 'info');
imagePath = await uploadImage(imageFile);
}
await apiRequest(`/api/boards/${currentBoard.key}/threads`, {
method: 'POST',
body: JSON.stringify({
title: formData.get('title'),
body_md: formData.get('body_md'),
signal: formData.get('signal'),
tags: formData.get('tags'),
image_path: imagePath
})
});
showNotification('Thread created successfully', 'success');
event.target.reset();
document.getElementById('thread-preview').classList.add('hidden');
showThreadList();
loadThreads(currentBoard.key, currentBoard.name);
} catch (error) {
showNotification(error.message, 'error');
}
}

// Fixed post creation with proper image upload
async function handleNewPost(event) {
event.preventDefault();
const formData = new FormData(event.target);
try {
showNotification('Posting reply...', 'info');
let imagePath = null;
const imageFile = document.getElementById('post-image').files[0];
if (imageFile) {
showNotification('Uploading image...', 'info');
imagePath = await uploadImage(imageFile);
}
await apiRequest(`/api/threads/${currentThread.id}/posts`, {
method: 'POST',
body: JSON.stringify({
body_md: formData.get('body_md'),
image_path: imagePath
})
});
showNotification('Reply posted successfully', 'success');
event.target.reset();
document.getElementById('post-preview').classList.add('hidden');
loadThread(currentThread.id, currentThread.title);
} catch (error) {
showNotification(error.message, 'error');
}
}

async function toggleSticky(threadId, sticky) {
try {
await apiRequest(`/api/threads/${threadId}`, {
method: 'PATCH',
body: JSON.stringify({ sticky })
});
loadThread(threadId, currentThread.title);
showNotification(`Thread ${sticky ? 'stickied' : 'unstickied'}`, 'success');
} catch (error) {
showNotification(error.message, 'error');
}
}

async function toggleLocked(threadId, locked) {
try {
await apiRequest(`/api/threads/${threadId}`, {
method: 'PATCH',
body: JSON.stringify({ locked })
});
loadThread(threadId, currentThread.title);
showNotification(`Thread ${locked ? 'locked' : 'unlocked'}`, 'success');
} catch (error) {
showNotification(error.message, 'error');
}
}

async function togglePinned(threadId, pinned) {
try {
await apiRequest(`/api/threads/${threadId}`, {
method: 'PATCH',
body: JSON.stringify({ pinned })
});
loadThread(threadId, currentThread.title);
showNotification(`Thread ${pinned ? 'pinned' : 'unpinned'}`, 'success');
} catch (error) {
showNotification(error.message, 'error');
}
}

// Chat functions
async function loadChatRooms() {
try {
const data = await apiRequest('/api/chat/rooms');
displayChatRooms(data.rooms);
} catch (error) {
console.error('Failed to load chat rooms:', error);
showNotification('Failed to load chat rooms', 'error');
}
}

function displayChatRooms(rooms) {
const container = document.getElementById('chat-rooms-list');
container.innerHTML = rooms.map(room => `
<div class="chat-room ${room.key === currentChatRoom ? 'active' : ''}"
onclick="joinChatRoom('${room.key}')">
${room.title}
</div>
`).join('');
}

function joinChatRoom(roomKey) {
currentChatRoom = roomKey;
if (socket && socket.connected) {
socket.emit('join', roomKey);
}
loadChatMessages(roomKey);
// Update UI
document.querySelectorAll('.chat-room').forEach(room => room.classList.remove('active'));
event.target.classList.add('active');
}

async function loadChatMessages(roomKey) {
try {
// First try to load from our local cache
if (chatMessages[roomKey] && chatMessages[roomKey].length > 0) {
displayCachedMessages(chatMessages[roomKey]);
return;
}
// If no cached messages, load from server
const data = await apiRequest(`/api/chat/rooms/${roomKey}/messages?limit=50`);
chatMessages[roomKey] = data.messages;
displayCachedMessages(data.messages);
} catch (error) {
console.error('Failed to load chat messages:', error);
showNotification('Failed to load chat messages', 'error');
}
}

function displayCachedMessages(messages) {
const container = document.getElementById('chat-messages');
container.innerHTML = messages.map(message => {
const canDelete = message.author === currentUser.handle_number || currentUser.handle_number === 'witness1';
return `
<div class="chat-message">
<span class="chat-author" onclick="showMemberProfile('${message.author}')">${message.author}:</span>
${message.body}
<span class="chat-time">${new Date(message.created_at).toLocaleTimeString()}</span>
${message.image_path ? `<br><img src="${message.image_path}" class="image-preview">` : ''}
${canDelete ? `
<div class="message-actions">
<button class="delete-btn" onclick="deleteChatMessage(${message.id})">Delete</button>
</div>
` : ''}
</div>
`;
}).join('');
// Scroll to bottom
container.scrollTop = container.scrollHeight;
}

function displayChatMessage(message) {
const container = document.getElementById('chat-messages');
const canDelete = message.author === currentUser.handle_number || currentUser.handle_number === 'witness1';
const messageElement = document.createElement('div');
messageElement.className = 'chat-message';
messageElement.innerHTML = `
<span class="chat-author" onclick="showMemberProfile('${message.author}')">${message.author}:</span>
${message.body}
<span class="chat-time">${new Date(message.created_at).toLocaleTimeString()}</span>
${message.image_path ? `<br><img src="${message.image_path}" class="image-preview">` : ''}
${canDelete ? `
<div class="message-actions">
<button class="delete-btn" onclick="deleteChatMessage(${message.id})">Delete</button>
</div>
` : ''}
`;
container.appendChild(messageElement);
container.scrollTop = container.scrollHeight;
}

async function sendChatMessage() {
const input = document.getElementById('chat-input');
const message = input.value.trim();
if (message && socket && socket.connected) {
socket.emit('message', {
roomKey: currentChatRoom,
body: message
});
input.value = '';
} else if (!socket || !socket.connected) {
showNotification('Chat disconnected. Reconnecting...', 'error');
// Try to reconnect
initializeSocket();
}
}

function handleChatKeypress(event) {
if (event.key === 'Enter') {
sendChatMessage();
}
}

// Initialize socket connection separately for better error handling
function initializeSocket() {
if (socket) {
socket.disconnect();
}
try {
socket = io({
transports: ['websocket', 'polling'],
timeout: 20000,
auth: {
token: document.cookie.split('; ').find(row => row.startsWith('token='))?.split('=')[1]
}
});

socket.on('connect', () => {
console.log('Socket reconnected');
showNotification('Chat reconnected', 'success');
if (currentChatRoom) {
socket.emit('join', currentChatRoom);
}
});

socket.on('message', (data) => {
displayChatMessage(data);
// Store message in our local cache
if (!chatMessages[currentChatRoom]) {
chatMessages[currentChatRoom] = [];
}
chatMessages[currentChatRoom].push(data);
});

socket.on('disconnect', () => {
console.log('Socket disconnected');
showNotification('Chat disconnected', 'error');
});

socket.on('connect_error', (error) => {
console.error('Socket connection error:', error);
showNotification('Chat connection failed', 'error');
});
} catch (error) {
console.error('Socket initialization failed:', error);
showNotification('Chat system unavailable', 'error');
}
}

// Initialize on load
document.addEventListener('DOMContentLoaded', async () => {
showNotification('Anonymous Liberty portal online', 'success');
// Check if already logged in
try {
const data = await apiRequest('/api/me');
currentUser = data.user;
initializeHunterNet();
showNotification('Reconnected to Hunter-Net', 'success');
} catch (error) {
// Not logged in, show regular interface
console.log('Not logged in');
}
});
</script>
</body>
</html>value.trim();
if (!message) return;

try {
await apiRequest(`/api/private-chats/${currentPrivateChat}/messages`, {
method: 'POST',
body: JSON.stringify({ body: message })
});
input.
